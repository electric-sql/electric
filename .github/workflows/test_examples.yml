name: Test Examples

on:
  schedule:
    - cron: '0 9 * * *'  # Runs daily at 9 AM UTC
  workflow_dispatch:  # Allow manual triggering

jobs:
  test:
    name: Test ${{ matrix.example.name }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Test remix example
        id: remix
        continue-on-error: true
        uses: ./.github/actions/test-example
        with:
          example_name: remix
          example_url: https://remix.examples.electric-sql.com
      
      - name: Test nextjs example
        id: nextjs
        continue-on-error: true
        uses: ./.github/actions/test-example
        with:
          example_name: nextjs
          example_url: https://nextjs.examples.electric-sql.com
      
      - name: Test tanstack example
        id: tanstack
        continue-on-error: true
        uses: ./.github/actions/test-example
        with:
          example_name: tanstack
          example_url: https://tanstack.examples.electric-sql.com

      - name: Test react example
        id: react
        continue-on-error: true
        uses: ./.github/actions/test-example
        with:
          example_name: react
          example_url: https://react.examples.electric-sql.com

      - name: Report test failures
        if: |
          steps.remix.outcome == 'failure' ||
          steps.nextjs.outcome == 'failure' ||
          steps.tanstack.outcome == 'failure' ||
          steps.react.outcome == 'failure'
        run: |
          echo "The following examples failed:"
          if [ "${{ steps.remix.outcome }}" == "failure" ]; then
            echo "- Remix example"
          fi
          if [ "${{ steps.nextjs.outcome }}" == "failure" ]; then
            echo "- Next.js example"
          fi
          if [ "${{ steps.tanstack.outcome }}" == "failure" ]; then
            echo "- TanStack example"
          fi
          if [ "${{ steps.react.outcome }}" == "failure" ]; then
            echo "- React example"
          fi
          exit 1
