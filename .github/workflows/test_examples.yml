name: Test Examples

on:
  schedule:
    - cron: '0 9 * * *'  # Runs daily at 9 AM UTC
  workflow_dispatch:  # Allow manual triggering

jobs:
  test:
    name: Test ${{ matrix.example.name }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Test remix example
        id: remix
        continue-on-error: true
        uses: ./.github/actions/test-example
        with:
          example_name: remix
          example_url: https://remix.examples.electric-sql.com
      
      - name: Test nextjs example
        id: nextjs
        continue-on-error: true
        uses: ./.github/actions/test-example
        with:
          example_name: nextjs
          example_url: https://nextjs.examples.electric-sql.com
      
      - name: Test tanstack example
        id: tanstack
        continue-on-error: true
        uses: ./.github/actions/test-example
        with:
          example_name: tanstack
          example_url: https://tanstack.examples.electric-sql.com

      - name: Fail if any test failed
        if: |
          steps.remix.outcome == 'failure' ||
          steps.nextjs.outcome == 'failure' ||
          steps.tanstack.outcome == 'failure'
        run: |
          echo "One or more tests failed"
          exit 1
